<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Game - Python Technical Questions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" media="print" onload="this.media='all'">
    <style>
        .flashcard {
            transition: transform 0.3s ease;
        }
        .flashcard:hover {
            transform: scale(1.02);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">
                üéÆ Flashcard Practice Game
            </h1>
            <p class="text-xl text-gray-600">
                Practice LeetCode questions in an interactive flashcard format
            </p>
        </header>

        <!-- Navigation -->
        <div class="flex justify-center mb-8">
            <a href="/" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors mr-4">
                ‚Üê Back to Main App
            </a>
            <button onclick="showStats()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                üìä View Stats
            </button>
        </div>

        <!-- Session Setup -->
        <div id="session-setup" class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">üéØ Start Practice Session</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="category-select" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty</label>
                    <select id="difficulty-select" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">All Difficulties</option>
                    </select>
                </div>
            </div>
            
            <button onclick="startSession()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-8 py-3 rounded-lg transition-colors font-semibold">
                üöÄ Start Practice Session
            </button>
        </div>

        <!-- Game Interface -->
        <div id="game-interface" class="hidden">
            <!-- Question Display -->
            <div id="question-display" class="bg-white rounded-lg shadow-lg p-8 mb-6 fade-in">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="question-title" class="text-2xl font-bold text-gray-800"></h3>
                    <div class="flex gap-2">
                        <span id="question-category" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium"></span>
                        <span id="question-difficulty" class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium"></span>
                    </div>
                </div>
                <div id="question-problem" class="text-gray-700 leading-relaxed whitespace-pre-wrap"></div>
            </div>

            <!-- Game Controls -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex flex-wrap gap-4 justify-center">
                    <button onclick="showHint()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg transition-colors">
                        üí° Get Hint
                    </button>
                    <button onclick="showSolution()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg transition-colors">
                        ‚úÖ View Solution
                    </button>
                    <button onclick="submitAnswer(true)" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors">
                        ‚úÖ Got It Right
                    </button>
                    <button onclick="submitAnswer(false)" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg transition-colors">
                        ‚ùå Got It Wrong
                    </button>
                    <button onclick="nextQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg transition-colors">
                        ‚è≠Ô∏è Skip Question
                    </button>
                </div>
            </div>

            <!-- Hints and Solutions -->
            <div id="hints-section" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
                <h4 class="text-lg font-semibold text-yellow-800 mb-3">üí° Hints:</h4>
                <div id="hints-content" class="text-yellow-700"></div>
            </div>

            <div id="solution-section" class="hidden bg-purple-50 border border-purple-200 rounded-lg p-6 mb-6">
                <h4 class="text-lg font-semibold text-purple-800 mb-3">‚úÖ Solution:</h4>
                <pre id="solution-content" class="text-purple-700 bg-white p-4 rounded border overflow-x-auto"></pre>
            </div>

            <!-- Session Summary -->
            <div id="session-summary" class="hidden bg-green-50 border border-green-200 rounded-lg p-6">
                <h4 class="text-lg font-semibold text-green-800 mb-3">üéâ Session Complete!</h4>
                <div id="summary-content" class="text-green-700"></div>
                <button onclick="resetSession()" class="mt-4 bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                    üîÑ Start New Session
                </button>
            </div>
        </div>

        <!-- Statistics Modal -->
        <div id="stats-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">üìä Your Statistics</h3>
                    <button onclick="hideStats()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="stats-content" class="text-gray-700"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin.replace('5001', '5000');
        let currentQuestion = null;

        // Load categories and difficulties on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await loadCategories();
        });

        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/flashcard/categories`);
                const data = await response.json();
                
                const categorySelect = document.getElementById('category-select');
                const difficultySelect = document.getElementById('difficulty-select');
                
                data.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    categorySelect.appendChild(option);
                });
                
                data.difficulties.forEach(difficulty => {
                    const option = document.createElement('option');
                    option.value = difficulty;
                    option.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
                    difficultySelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function startSession() {
            const category = document.getElementById('category-select').value;
            const difficulty = document.getElementById('difficulty-select').value;
            
            try {
                const response = await fetch(`${API_BASE}/flashcard/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ category, difficulty })
                });
                
                const data = await response.json();
                
                if (data.questions_loaded > 0) {
                    document.getElementById('session-setup').classList.add('hidden');
                    document.getElementById('game-interface').classList.remove('hidden');
                    await nextQuestion();
                } else {
                    alert('No questions found for the selected filters.');
                }
            } catch (error) {
                console.error('Error starting session:', error);
                alert('Failed to start session.');
            }
        }

        async function nextQuestion() {
            try {
                const response = await fetch(`${API_BASE}/flashcard/question`);
                
                if (response.status === 404) {
                    showSessionSummary();
                    return;
                }
                
                const data = await response.json();
                currentQuestion = data.question;
                
                displayQuestion(currentQuestion);
                hideHintsAndSolution();
            } catch (error) {
                console.error('Error getting question:', error);
            }
        }

        function displayQuestion(question) {
            document.getElementById('question-title').textContent = question.title;
            document.getElementById('question-category').textContent = question.category;
            document.getElementById('question-difficulty').textContent = question.difficulty;
            document.getElementById('question-problem').textContent = question.problem;
        }

        async function showHint() {
            try {
                const response = await fetch(`${API_BASE}/flashcard/hint`);
                const data = await response.json();
                
                const hintsContent = document.getElementById('hints-content');
                hintsContent.innerHTML = data.hints.map((hint, index) => 
                    `<div class="mb-2">${index + 1}. ${hint}</div>`
                ).join('');
                
                document.getElementById('hints-section').classList.remove('hidden');
            } catch (error) {
                console.error('Error getting hints:', error);
            }
        }

        async function showSolution() {
            try {
                const response = await fetch(`${API_BASE}/flashcard/solution`);
                const data = await response.json();
                
                document.getElementById('solution-content').textContent = data.solution;
                document.getElementById('solution-section').classList.remove('hidden');
            } catch (error) {
                console.error('Error getting solution:', error);
            }
        }

        async function submitAnswer(isCorrect) {
            try {
                await fetch(`${API_BASE}/flashcard/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ correct: isCorrect })
                });
                
                await nextQuestion();
            } catch (error) {
                console.error('Error submitting answer:', error);
            }
        }

        function hideHintsAndSolution() {
            document.getElementById('hints-section').classList.add('hidden');
            document.getElementById('solution-section').classList.add('hidden');
        }

        function showSessionSummary() {
            document.getElementById('session-summary').classList.remove('hidden');
            document.getElementById('summary-content').innerHTML = `
                <p>Great job completing this practice session!</p>
                <p>Check your statistics to see your progress.</p>
            `;
        }

        function resetSession() {
            document.getElementById('game-interface').classList.add('hidden');
            document.getElementById('session-setup').classList.remove('hidden');
            document.getElementById('session-summary').classList.add('hidden');
            hideHintsAndSolution();
        }

        async function showStats() {
            try {
                const response = await fetch(`${API_BASE}/flashcard/stats`);
                const data = await response.json();
                
                const statsContent = document.getElementById('stats-content');
                const stats = data.overall_stats;
                
                if (stats.total_questions === 0) {
                    statsContent.innerHTML = '<p>No questions answered yet. Start practicing to see your stats!</p>';
                } else {
                    const accuracy = ((stats.correct_answers / stats.total_questions) * 100).toFixed(1);
                    
                    statsContent.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600">${stats.total_questions}</div>
                                <div class="text-blue-700">Total Questions</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600">${stats.correct_answers}</div>
                                <div class="text-green-700">Correct Answers</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600">${accuracy}%</div>
                                <div class="text-purple-700">Accuracy</div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-semibold mb-2">Current Streak: ${stats.streak}</h4>
                        </div>
                        
                        ${stats.questions_by_category ? `
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">By Category:</h4>
                                ${Object.entries(stats.questions_by_category).map(([category, catStats]) => {
                                    const catAccuracy = ((catStats.correct / catStats.total) * 100).toFixed(1);
                                    return `<div class="ml-4">${category}: ${catStats.correct}/${catStats.total} (${catAccuracy}%)</div>`;
                                }).join('')}
                            </div>
                        ` : ''}
                        
                        ${stats.questions_by_difficulty ? `
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">By Difficulty:</h4>
                                ${Object.entries(stats.questions_by_difficulty).map(([difficulty, diffStats]) => {
                                    const diffAccuracy = ((diffStats.correct / diffStats.total) * 100).toFixed(1);
                                    return `<div class="ml-4">${difficulty}: ${diffStats.correct}/${diffStats.total} (${diffAccuracy}%)</div>`;
                                }).join('')}
                            </div>
                        ` : ''}
                    `;
                }
                
                document.getElementById('stats-modal').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function hideStats() {
            document.getElementById('stats-modal').classList.add('hidden');
        }
    </script>
</body>
</html>
